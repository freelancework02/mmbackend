<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>FAQs | Maula Ali Research Center</title>

  <!-- Tailwind CDN (remove if you already ship Tailwind in your bundle) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Your fonts/theme file -->
  <link rel="stylesheet" href="/assets/Style/fonts.css" />

  <link rel="icon" href="/images/marc.png" type="image/x-icon" />

  <style>
    /* Helpers */
    .line-clamp-1 { display:-webkit-box; -webkit-line-clamp:1; -webkit-box-orient:vertical; overflow:hidden; }
    .line-clamp-2 { display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .font-nastaliq { font-family: "Noto Nastaliq Urdu", serif; }
    .gulzartext   { font-family: "Gulzar", serif; }
    .arabic-text  { font-family: "Amiri", serif; }
    :root{
      --green-700:#4a7031;
      --brand:#718e56;     /* header */
      --brand-dark:#5a7544;/* mobile menu */
    }
    /* Card polish similar to screenshot */
    .qa-card{
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(15, 23, 42, 0.06);
    }
    .qa-card:hover{
      box-shadow: 0 18px 35px rgba(15, 23, 42, 0.10);
    }
    .badge-num{
      background: #1f4b57; /* teal like screenshot badge */
    }
    /* View toggle active */
    .layout-toggle-active{ background:#10b981; color:#fff; }
    .layout-toggle-active:hover{ background:#059669; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- Header -->
  <header class="bg-[var(--brand)] sticky top-0 z-50 shadow-md border-b border-green-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4 relative">
        <!-- Left nav (desktop) -->
        <nav class="hidden md:flex gap-6 text-md text-white tracking-wide">
          <a href="/">ہوم</a>
          <a href="/about">تعارف</a>
          <a href="/newsandevent">خبریں و تقاریب</a>
          <a href="/books">کتب</a>
        </nav>

        <!-- Center logo -->
        <div class="absolute left-1/2 transform -translate-x-1/2 -bottom-7 bg-white rounded-full p-1 shadow-lg border border-green-100 z-10">
          <img src="/images/marc.png" alt="Logo" class="w-16 h-16 rounded-full object-contain" />
        </div>

        <!-- Right nav (desktop) -->
        <nav class="hidden md:flex gap-6 text-md text-white tracking-wide">
          <a href="/article">مضامین</a>
          <a href="/question">سوال و جواب</a>
          <a href="/requestbook">کتاب کی درخواست</a>
          <a href="/contact">رابطہ</a>
        </nav>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button id="mobileMenuBtn" class="text-white focus:outline-none" aria-label="Toggle menu">
            <svg id="mobileMenuIcon" class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile dropdown -->
      <div id="mobileMenu" class="md:hidden transition-all overflow-hidden max-h-0 opacity-0">
        <div class="flex flex-col gap-3 py-4 px-2 text-white bg-[var(--brand-dark)] rounded-b-xl">
          <a href="/" class="px-4 py-2">ہوم</a>
          <a href="/about" class="px-4 py-2">تعارف</a>
          <a href="/books" class="px-4 py-2">کتب</a>
          <a href="/newsandevent" class="px-4 py-2">خبریں و تقاریب</a>
          <a href="/article" class="px-4 py-2">مضامین</a>
          <a href="/question" class="px-4 py-2">سوال و جواب</a>
          <a href="/requestbook" class="px-4 py-2">کتاب کی درخواست</a>
          <a href="/contact" class="px-4 py-2">رابطہ</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Background watermark -->
  <div class="absolute inset-0 opacity-30 pointer-events-none" style="background-image:url('/images/newbg.png'); background-size:cover; background-position:center;"></div>

  <!-- Intro banner -->
  <div class="relative z-10 w-full -mt-8 overflow-hidden bg-cover bg-center" style="background-image:url('/images/newbg.png')">
    <div class="flex items-center justify-center mt-8 h-[200px] w-full bg-[#C0D7AA]/80 rounded-b-[2rem] sm:mt-8">
      <div class="text-center mb-6 px-4">
        <h3 class="heading text-2xl font-bold text-[var(--green-700)] mt-12">شرعی سوالات</h3>
        <p class="text-md text-gray-700 sub-heading text-[18.5px]">
          ہمارے مرکز کا مقصد اسلامی تعلیمات کی روشنی میں موجودہ مسائل کا حل پیش کرنا ہے۔
          یہاں آپ سوالات دیکھ سکتے ہیں اور تفصیلی جوابات پڑھ سکتے ہیں۔
        </p>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="relative z-10 container mx-auto px-4 py-8">

    <!-- Controls -->
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 px-2 md:px-4">
      <!-- Search -->
      <div class="relative w-full md:w-2/5 lg:w-1/3">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
          <!-- search icon -->
          <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </svg>
        </div>
        <input id="searchInput"
               type="text"
               class="font-nastaliq block w-full rounded-full bg-white border border-slate-300 py-2.5 px-4 text-right pl-12 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:outline-none text-sm placeholder-slate-400"
               placeholder="تلاش کریں" />
      </div>

      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full md:w-auto">

        <!-- Sort dropdown -->
        <div class="relative">
          <div class="flex flex-col">
            <label class="text-xs text-slate-600 mb-1 font-nastaliq">ترتیب</label>
            <div class="relative">
              <button id="sortBtn"
                      class="flex items-center justify-between gap-2 bg-white border border-slate-300 rounded-md px-3 py-1.5 w-40 text-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                <span id="sortLabel" class="text-slate-700">Latest</span>
                <svg class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div id="sortMenu" class="hidden absolute z-10 mt-1 w-40 bg-white shadow-lg rounded-md py-1 border border-slate-200">
                <button data-sort="Latest"  class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">Latest</button>
                <button data-sort="Oldest"  class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">Oldest</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Language dropdown -->
        <div class="relative">
          <div class="flex flex-col">
            <label class="text-xs text-slate-600 mb-1 font-nastaliq">زبان</label>
            <div class="relative">
              <button id="langBtn"
                      class="flex items-center justify-between gap-2 bg-white border border-slate-300 rounded-md px-3 py-1.5 w-40 text-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                <span id="langLabel" class="font-nastaliq text-slate-700">All</span>
                <svg class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div id="langMenu" class="hidden absolute z-10 mt-1 w-40 bg-white shadow-lg rounded-md py-1 border border-slate-200">
                <button data-lang="All"     class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">All</button>
                <button data-lang="اردو"     class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">اردو</button>
                <button data-lang="English" class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">English</button>
                <button data-lang="Roman"   class="w-full text-right px-3 py-1.5 text-sm hover:bg-slate-100">Roman</button>
              </div>
            </div>
          </div>
        </div>

        <!-- View toggle -->
        <div class="relative sm:mt-[1.35rem]">
          <div class="flex items-center gap-1 p-0.5 bg-slate-100 rounded-md border border-slate-200">
            <button id="listToggleBtn" title="List View"
              class="cursor-pointer p-1.5 rounded-md text-slate-500 hover:bg-white hover:text-emerald-600 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-400">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" x2="21" y1="6" y2="6" />
                <line x1="8" x2="21" y1="12" y2="12" />
                <line x1="8" x2="21" y1="18" y2="18" />
                <line x1="3" x2="3.01" y1="6" y2="6" />
                <line x1="3" x2="3.01" y1="12" y2="12" />
                <line x1="3" x2="3.01" y1="18" y2="18" />
              </svg>
            </button>
            <button id="gridToggleBtn" title="Grid View"
              class="cursor-pointer p-1.5 rounded-md text-slate-500 hover:bg-white hover:text-emerald-600 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-400">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect width="7" height="7" x="3"  y="3"  rx="1" />
                <rect width="7" height="7" x="14" y="3"  rx="1" />
                <rect width="7" height="7" x="14" y="14" rx="1" />
                <rect width="7" height="7" x="3"  y="14" rx="1" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Section label -->
    <div class="flex justify-end mb-6 px-2 md:px-4">
      <h2 class="font-nastaliq bg-emerald-100 text-emerald-700 rounded-full px-5 py-2 text-base font-semibold">
        سوالات کی فہرست
      </h2>
    </div>

    <!-- Cards -->
    <main id="cardsContainer" class="w-full px-2 md:px-4 grid grid-cols-1 md:grid-cols-2 gap-5"></main>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 top-10 flex flex-col justify-center items-center bg-slate-100/80 space-y-6 z-50">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"></div>
      <div class="amiri-regular text-2xl text-emerald-700 font-semibold arabic-text">
        صَلَّى ٱللّٰهُ عَلَيْهِ وَآلِهِ وَسَلَّمَ
      </div>
    </div>

    <!-- Empty state -->
    <div id="emptyState" class="hidden w-full text-center py-10">
      <p class="font-nastaliq text-lg text-slate-600">کوئی سوال دستیاب نہیں ہے</p>
    </div>
  </div>

  <script>
    // ====== Config ======
    const API_QUESTIONS = "https://minaramasjid-backend.onrender.com/api/questions";

    // ====== State ======
    let questions = [];
    let viewMode = localStorage.getItem("viewMode") === "list" ? "list" : "grid";
    let selectedLang = "All";
    let selectedSort = "Latest";
    let searchQuery = "";

    // ====== Elements ======
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileMenuIcon = document.getElementById("mobileMenuIcon");
    const mobileMenu = document.getElementById("mobileMenu");

    const searchInput = document.getElementById("searchInput");
    const sortBtn = document.getElementById("sortBtn");
    const sortMenu = document.getElementById("sortMenu");
    const sortLabel = document.getElementById("sortLabel");

    const langBtn = document.getElementById("langBtn");
    const langMenu = document.getElementById("langMenu");
    const langLabel = document.getElementById("langLabel");

    const listToggleBtn = document.getElementById("listToggleBtn");
    const gridToggleBtn = document.getElementById("gridToggleBtn");

    const cardsContainer = document.getElementById("cardsContainer");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const emptyState = document.getElementById("emptyState");

    // ====== Utils ======
    const isUrdu = (txt) => /[\u0600-\u06FF]/.test(String(txt || ""));
    const slugify = (text) => String(text || "")
      .toLowerCase().trim()
      .replace(/\s+/g, "-")
      .replace(/[.,\/#!$%\^&\*;:{}=\_`~()؟"']/g, "")
      .replace(/-+/g, "-");

    function setMenu(open){
      if(open){
        mobileMenu.classList.remove("max-h-0", "opacity-0");
        mobileMenu.classList.add("max-h-screen", "opacity-100");
        mobileMenuIcon.setAttribute("d","M6 18L18 6M6 6l12 12");
      }else{
        mobileMenu.classList.remove("max-h-screen", "opacity-100");
        mobileMenu.classList.add("max-h-0", "opacity-0");
        mobileMenuIcon.setAttribute("d","M4 6h16M4 12h16M4 18h16");
      }
    }

    function applyViewMode(){
      if(viewMode === "list"){
        listToggleBtn.classList.add("layout-toggle-active");
        gridToggleBtn.classList.remove("layout-toggle-active");
        cardsContainer.className = "w-full px-2 md:px-4 flex flex-col gap-3";
        // make existing cards landscape
        cardsContainer.querySelectorAll(".qa-card-wrap").forEach(w=>{
          w.classList.remove("flex-col");
          w.classList.add("flex-row","items-center");
        });
      }else{
        gridToggleBtn.classList.add("layout-toggle-active");
        listToggleBtn.classList.remove("layout-toggle-active");
        cardsContainer.className = "w-full px-2 md:px-4 grid grid-cols-1 md:grid-cols-2 gap-5";
        // make existing cards vertical
        cardsContainer.querySelectorAll(".qa-card-wrap").forEach(w=>{
          w.classList.remove("flex-row","items-center");
          w.classList.add("flex-col");
        });
      }
      localStorage.setItem("viewMode", viewMode);
    }

    function fmtViews(n){ try{ return Number(n||0).toLocaleString("en-IN"); } catch { return n||0; } }

    function cardHTML(item, idx){
      const qText = item.questionUrdu || item.questionEnglish || "";
      const dir = isUrdu(qText) ? "rtl" : "ltr";
      const align = isUrdu(qText) ? "text-right font-nastaliq" : "text-left";
      const langChip = item.language === "اردو" ? "اردو" : (item.language || "English");
      const detailUrl = `/question/${item.id}/${slugify(item.slug || qText)}`;

      return `
        <a href="${detailUrl}" class="group block bg-white rounded-2xl qa-card transition-all duration-300 ease-in-out hover:-translate-y-0.5">
          <div class="qa-card-wrap flex ${viewMode === "list" ? "flex-row items-center" : "flex-col"} p-5">
            <!-- right badge -->
            <div class="order-2 md:order-none md:self-start md:ml-0 ml-4">
              <div class="flex items-center justify-center w-14 h-14 rounded-2xl badge-num text-white text-xl font-bold shadow-md bg-[var(--brand)]">
                ${idx + 1}
              </div>
            </div>

            <!-- content -->
            <div class="flex-1 ${viewMode === "list" ? "mr-4" : "mt-3"}">
              <p dir="${dir}" class="${viewMode === "list" ? "line-clamp-1 mb-2" : "line-clamp-2 mb-2"} ${align} text-slate-800 text-[18px] leading-relaxed">
                ${qText}
              </p>

              <div class="mt-2 pt-3 border-t border-slate-200 flex items-center justify-between">
                <!-- views (left) -->
                <span class="flex items-center text-slate-500 text-sm">
                  <span class="mr-1">${fmtViews(item.views || 0)}</span>
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </span>

                <!-- read more (right) -->
                <span class="font-nastaliq text-[var(--green-700)] hover:text-emerald-700 text-sm md:text-base font-semibold">
                  مکمل جواب پڑھیں &larr;
                </span>
              </div>

              <!-- chips -->
              <div class="mt-3 flex gap-2 justify-end">
                <span class="bg-emerald-50 text-emerald-700 px-3 py-1 rounded-lg text-xs font-medium">${langChip}</span>
                <span class="bg-slate-100 text-slate-700 px-3 py-1 rounded-lg text-xs font-medium">${langChip}</span>
              </div>
            </div>
          </div>
        </a>
      `;
    }

    function render(list){
      cardsContainer.innerHTML = "";
      if(!list.length){
        emptyState.classList.remove("hidden");
        return;
      }
      emptyState.classList.add("hidden");
      const frag = document.createDocumentFragment();
      list.forEach((item, i)=>{
        const wrapper = document.createElement("div");
        wrapper.innerHTML = cardHTML(item, i);
        frag.appendChild(wrapper.firstElementChild);
      });
      cardsContainer.appendChild(frag);
      applyViewMode();
    }

    function applyFilters(){
      let out = [...questions];

      // language
      if(selectedLang !== "All"){
        out = out.filter(q => String(q.language || "").toLowerCase() === String(selectedLang).toLowerCase());
      }
      // search
      if(searchQuery.trim()){
        const s = searchQuery.toLowerCase();
        out = out.filter(q=>{
          const text = String(q.questionUrdu || q.questionEnglish || "").toLowerCase();
          return text.includes(s);
        });
      }
      // sort
      out.sort((a,b)=>{
        const da = new Date(a.createdAt || 0);
        const db = new Date(b.createdAt || 0);
        return (selectedSort === "Latest") ? (db - da) : (da - db);
      });

      render(out);
    }

    // ====== Events ======
    mobileMenuBtn.addEventListener("click", ()=>{
      const open = mobileMenu.classList.contains("max-h-screen");
      setMenu(!open);
    });

    // dropdown toggles + selections
    sortBtn.addEventListener("click", ()=> sortMenu.classList.toggle("hidden"));
    langBtn.addEventListener("click", ()=> langMenu.classList.toggle("hidden"));

    sortMenu.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        selectedSort = btn.dataset.sort;
        sortLabel.textContent = selectedSort;
        sortMenu.classList.add("hidden");
        applyFilters();
      });
    });

    langMenu.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        selectedLang = btn.dataset.lang;
        langLabel.textContent = selectedLang;
        langMenu.classList.add("hidden");
        applyFilters();
      });
    });

    // view toggles
    listToggleBtn.addEventListener("click", ()=>{
      viewMode = "list";
      applyViewMode();
    });
    gridToggleBtn.addEventListener("click", ()=>{
      viewMode = "grid";
      applyViewMode();
    });

    // search
    searchInput.addEventListener("input", (e)=>{
      searchQuery = e.target.value || "";
      applyFilters();
    });

    // ====== Init ======
    (async function init(){
      try{
        loadingOverlay.classList.remove("hidden");
        const res = await fetch(API_QUESTIONS);
        const data = await res.json();
        questions = Array.isArray(data) ? data : [];
        applyViewMode();
        applyFilters();
      }catch(err){
        console.error("Failed to fetch questions:", err);
        emptyState.classList.remove("hidden");
      }finally{
        loadingOverlay.classList.add("hidden");
      }
    })();
  </script>
</body>
</html>
